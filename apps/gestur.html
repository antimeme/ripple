<!DOCTYPE html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, user-scalable=no" />
<meta name="viewport" content="initial-scale=1, maximum-scale=1" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<title>Gestur: Gesture Library Test</title>
<style>
 html, body, canvas, div { margin: 0; padding: 0 }
 body {
     background-color: lightgreen;
     overflow-x: visible; overflow-y: hidden;
 }
 canvas {
     position: absolute; top: 0; bottom: 0; left: 0; right: 0;
     touch-action: none; /* important! */
 }
 #log {
     position: absolute; top: 0, bottom: 0, left: 0, right: 0;
     text-indent: -2em; margin-left: 2em;
 }
 #clear { position: absolute; top: 1%; right: 1%; }
 img { position: absolute; right: 0; top: 0; }
</style>

<div id="log"></div>
<!-- <img src="images/gestur.svg" /> -->
<canvas></canvas>
<button id="clear">CLEAR</button>

<script src="ripple/context.js"></script>
<script src="ripple/ripple.js"></script>
<script>//<![CDATA[
 ripple.ready(function() {
     var last = null;
     var post = function(description, details) {
         var entry, log = document.getElementById('log');
         if (last && last.description === description &&
             description === "drag") {
             if (log.childNodes.length > 0)
                 log.removeChild(log.firstChild);
         }
         last = {description: description};
         entry = document.createElement("div");
         entry.appendChild(
             document.createTextNode(
                 description + JSON.stringify(details)
                                   .replace(/,/g, ', ')));
         log.prepend(entry);
     };

     var resize = function() {
         var ctx, xx, yy, scale = 100;
         var canvas = document.querySelector("canvas");
         canvas.setAttribute("width", window.innerWidth);
         canvas.setAttribute("height", window.innerHeight);

         if (!canvas) { // Report unlikley problems if necessary
             alert("ERROR - missing canvas element"); return;
         } else if (!canvas.getContext) {
             alert("ERROR - canvas has no getContext"); return;
         } else if (!(ctx = canvas.getContext('2d'))) {
             alert("ERROR - canvas.getContext() failed"); return;
         }

         ctx.clearRect(0, 0, canvas.width, canvas.height);
         ctx.beginPath();
         for (xx = 0; xx < canvas.width; xx += scale) {
             ctx.moveTo(xx, 0);
             ctx.lineTo(xx, canvas.height);
         }
         for (yy = 0; yy < canvas.height; yy += scale) {
             ctx.moveTo(0, yy);
             ctx.lineTo(canvas.width, yy);
         }
         ctx.lineWidth = 2;
         ctx.strokeStyle = 'rgba(16, 16, 64, 0.5)';
         ctx.stroke();
     };
     window.addEventListener("resize", resize);
     resize();

     document.getElementById("clear").addEventListener(
         "click", function(event) {
             document.getElementById("log").innerHTML = ""; });

     ripple.gestur({
         tap: function(name, touch) { post(name, touch); },
         doubleTap: function(name, touch) { post(name, touch); },
         flick: function(name, start, end) {
             post(name, {start: start, end: end}); },
         drag: function(name, start, last, current) {
             post(name, {start: start, last: last,
                         current: current}); },
         wheel: function(name, scroll) { post(name, scroll); },
         pinchStart: function(name, one, two) {
             post(name, {one: one, two: two}); },
         pinchMove: function(name, length, angle) {
             post(name, {length: length, angle: angle}); },
         pinchDebug: function(name, value) {
             post(name, value);
         }
     }, document.querySelector("canvas"));
 }); //]]></script>
