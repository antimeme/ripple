<!DOCTYPE html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, user-scalable=no" />
<meta name="viewport" content="initial-scale=1, maximum-scale=1" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<title>Logic</title>
<style>
 td { border: 1px solid black; }
 td.solved { background: lightgreen; }
</style>

<h1>Logic</h1>
<div>Formula: <select id="formula"><option></option></select></div>
<textarea id="display" readonly="true" rows="5" cols="40">
</textarea>
<div>
    <button id="simplify">Simplify</button>
    <button id="deconstant">Deconstant</button>
    <button id="devolve">Devolve</button>
</div>
<div>
    <select id="variables"></select>
    <select id="values">
        <option>true</option>
        <option>false</option>
        <option>p</option>
        <option>q</option>
        <option>r</option>
        <option>s</option>
        <option>t</option>
        <option>w</option>
    </select>
    <button id="replace">Replace</button>
</div>

<table id="expressions">
    <tr>
        <th>Name</th>
        <th>Free</th>
        <th>Expression</th>
    </tr>
</table>

<!-- Constructing Kleene Axioms from Wajsberg's Axiom:
     * Conjunction Introduction:
   - Set psi to true; Simplify
   - Set phi to true; Simplify
   - Replace chi with phi; Replace tau with psi
     * Conjunction Left Elimination
   - Set phi to true; Simplify
   - Set tau to false; Simplify
   - Replace psi with phi and chi with psi
-->

<!-- Useful Theorems
     * Commutative AND
   - Set phi to true; Simplify
   - Set tau to true; Simplify
-->

<script src="ripple/polyfill.js"></script>
<script src="ripple/ripple.js"></script>
<script src="ripple/logic.js"></script>
<script>//<![CDATA[
 ripple.ready(function() {
     var expression = null;
     var display = document.getElementById("display");
     var variables = document.getElementById("variables");
     var formula = document.getElementById("formula");

     var apply = function(expr) {
         var ii;
         for (ii = variables.options.length - 1; ii >= 0; --ii)
             variables.remove(ii);
         expression = expr;
         expression.getFree().forEach(function(variable) {
             variables.appendChild(ripple.createElement('option', {
                 value: variable, innerHTML: variable}));
         });
         display.innerHTML = expression.toString();
     };

     formula.addEventListener("change", function(event) {
         var parts = event.target.value.split(':');
         if (parts.length >= 2)
             apply(logic.findLibrary(parts[0], parts[1]));
     });
     display.addEventListener("change", function(event) {
         console.log('WARNING-display-change', event.target.value);
     });
     document.getElementById(
         "simplify").addEventListener("click", function(event) {
             if (expression)
                 apply(expression.simplify()); });
     document.getElementById(
         "deconstant").addEventListener("click", function(event) {
             if (expression)
                 apply(expression.simplify({})); });
     document.getElementById(
         "devolve").addEventListener("click", function(event) {
             if (expression)
                 apply(expression.devolve()); });
     document.getElementById(
         "replace").addEventListener("click", function(event) {
             var value = values.value;
             if (value === 'true')
                 value = true;
             else if (value === 'false')
                 value = false;

             if (expression)
                 apply(expression.substitute(variables.value, value));
         });

     var table = document.getElementById("expressions");
     logic.eachLibrary(function(expression, details) {
         var label = details.name + ' ' + details.formula;
         var tag = details.name + ':' + details.formula;

         formula.appendChild(ripple.createElement(
             'option', {value: tag}, label));

         table.appendChild(ripple.createElement(
             'tr', null,
             ripple.createElement('td', {
                 rowspan: 3, className: details.wajsberg ?
                                        'solved' : undefined}, label),
             ripple.createElement('td', {
                 rowspan: 3,
                 innerHTML: expression.getFree().toString()}),
             ripple.createElement('td', {
                 innerHTML: expression.toString()})));

         var altered = expression.simplify();
         if (expression.equals(altered))
             altered = expression.devolve();
         table.appendChild(
             ripple.createElement(
                 'tr', null, ripple.createElement('td', {
                     innerHTML: altered.toString()})));

         var restored = altered.simplify();
         if (restored.equals(altered))
             restored = restored.devolve();
         table.appendChild(
             ripple.createElement(
                 'tr', null, ripple.createElement('td', {
                     innerHTML: restored.toString()})));
     });
 }); //]]></script>
